{% extends "app/reporting/base.html" %}

{% block localheadermeta %}
<title>{{campaign.title}} Responses - {{profile.printable_name}} | Practice Sharing Platform</title>
<meta property="og:title" content="{{campaign.title}} Responses - {{profile.printable_name}} | Practice Sharing Platform" />
<meta property="og:image" content="{{request|site_url}}/static/img/og-image.png" />
<meta name="description" property="og:description" content="Browse responses to {{campaign.title}}" />
{% endblock %}


{% block reporting_title %}{% trans %}Track{% endtrans %}{% endblock %}

{% block reporting_toggle %}
<div class="side-notes" style="font-size:0.8rem;">
  <h5>What are the different statuses?</h5>
  <div class="row">
    <div class="col-sm-6">
      <dl>
        <dt><i class="fa fa-certificate" style="color: green;"></i> verified</dt>
        <dd>A subject matter expert has read through the response and rated the accuracy of the response.</dd>
      </dl>
      <dl>
        <dt><i class="fa fa-circle" style="color: green;"></i> completed</dt>
        <dd>The reporting profile has completed the questionnaire and shared it with your account.</dd>
      </dl>
      <dl>
        <dt><i class="fa fa-circle" style="color: yellow;"></i> responded</dt>
        <dd>The reporting profile has completed the questionnaire but hasn't shared the response with your account yet.</dd>
      </dl>
      </div>
      <div class="col-sm-6">
      <dl>
        <dt><i class="fa fa-circle" style="color: red;"></i> no-response</dt>
        <dd>The reporting profile was invited but did not complete the questionnaire. It could either means they abandoned in the middle of responding or they have never started.</dd>
      </dl>
      <dl>
        <dt><i class="fa fa-circle" style="color: grey;"></i> no-data</dt>
        <dd>The reporting profile has not completed the questionnaire nor had been invited to do so.</dd>
      </dl>
      {% if urls.help %}
      <a href="{{urls.help}}" target="blank">find more help &raquo;</a>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}

{% block reporting_content %}
<reporting-organizations inline-template>
  <div>
    <div class="row">
      <div class="col-md-6">
        <form id="period-update" class="form-inline mt-4"
              @submit.prevent="reload()">
          <div class="input-group input-group-sm mr-2">
            <div class="input-group-prepend">
              <span class="input-group-text" id="from-inp">{% trans %}From{% endtrans %}</span>
            </div>
            <input class="form-control" type="date" v-model="_start_at" v-cloak>
          </div>
          <div class="input-group input-group-sm mr-2">
            <div class="input-group-prepend">
              <span class="input-group-text" id="from-inp">{% trans %}To{% endtrans %}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
            </div>
            <input class="form-control" type="date" v-model="_ends_at" v-cloak>
          </div>
          <div class="input-group input-group-sm mr-2">
              <select class="form-control"
                      v-model="params.period">
                  <option value="monthly">{% trans %}Monthly{% endtrans %}</option>
                  <option value="yearly">{% trans %}Yearly{% endtrans %}</option>
              </select>
          </div>
          <button class="btn btn-secondary btn-sm mr-2"
                :disabled="!outdated"
                type="submit">{% trans %}Update{% endtrans %}</button>
        </form>{# /#period-update #}
      </div>
    </div>
    <div class="row align-items-end">
      <div class="col-sm-6" v-show="itemsLoaded" v-cloak>
        <span class="mt-4">
          [[items.count]] {% trans %}accessible profiles{% endtrans %}
        </span>
      </div>
      {% if urls.download %}
      <div class="col-sm-6 text-right">
        <a class="mt-4 mb-1 btn btn-primary{% if request.path == urls.download %} active{% endif %}" id="xlsx-download-btn" :href="'{{urls.download}}' + getQueryString(['page'])">
          <i class="fa fa-file-text"></i> {% trans %}Download (xlsx){% endtrans %}
        </a>
      </div>
      {% endif %}
    </div>
    <table class="table table-striped">
      <thead>
        <tr>
          <th class="sticky-cell sticky-cell-top">
            <div class="sticky-cell-content-container">
              <div class="sticky-cell-content">
              </div>
            </div>
          </th>
          <th class="sticky-cell sticky-cell-top">
            <div class="sticky-cell-content-container">
              <div class="sticky-cell-content">
                {% trans %}Organization/profile{% endtrans %}
                <button class="btn btn-link btn-sort"
                        @click.prevent="sortBy('full_name')">
                  <i :class="sortIcon('full_name')"></i>
                </button>
              </div>
            </div>
          </th>
          <th class="sticky-cell sticky-cell-top">
            <div class="sticky-cell-content-container">
              <div class="sticky-cell-content">
                <button class="btn btn-sort">{% trans %}Tags{% endtrans %}</button>
              </div>
            </div>
          </th>
          <th class="sticky-cell sticky-cell-top text-center"
              v-for="(label, index) in items.labels.slice().reverse()"
              v-show="itemsLoaded && items.results.length > 0" v-cloak>
            <div class="sticky-cell-content-container">
              <div class="sticky-cell-content">
                  <button class="btn btn-sort">[[label]]</button>
                  <!--
                  <select class="form-select"
                          v-model="params.status"
                          @change="reload()">
                      <option value="">{% trans %}All{% endtrans %}</option>
                      <option value="verified"><i class="fa fa-certificate" style="color: green;"></i> verified</option>
                      <option value="completed"><i class="fa fa-circle" style="color: green;"></i> completed</option>
                      <option value="responded"><i class="fa fa-circle" style="color: yellow;"></i> responded</option>
                      <option value="declined"><i class="fa fa-circle" style="color: red;"></i> no-response</option>
                      <option value="no-data"><i class="fa fa-circle" style="color: red;"></i> no-data</option>
                  </select>
                  -->
              </div>
            </div>
          </th>
          <th class="sticky-cell sticky-cell-top">
            <div class="sticky-cell-content-container">
              <div class="sticky-cell-content">
              </div>
            </div>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td colspan="2">
            <form @submit.prevent="reload()">
              <div class="input-group input-group-sm">
                <div class="input-group-prepend">
                  <span class="input-group-text" id="from-inp"><i class="fa fa-search"></i></span>
                </div>
                <input class="form-control"
                       type="text"
                       placeholder="{% trans %}Profile name or e-mail address ...{% endtrans %}"
                       v-model="params.q" />
                <div class="input-group-append">
                    <button class="btn btn-secondary btn-sm"
                            type="submit"
                            :disabled="!outdated">{% trans %}Search{% endtrans %}</button>
                </div>
              </div>
            </form>
          </td>
          <td :colspan="items.labels.length + 2" v-show="itemsLoaded">
          </td>
        </tr>
      </tbody>
      <tbody v-show="!itemsLoaded">
        <tr>
          <td colspan="3">
            <h3  class="text-center"><i class="fa fa-refresh fa-spin fa-2x"></i></h3>
          </td>
        </tr>
      </tbody>
      <tbody v-show="itemsLoaded" v-cloak>
        <tr v-show="items.results.length == 0">
          <td :colspan="items.labels.length + 1 + 3">{% trans profile=profile.printable_name %}No scorecard available for the search query. Note that a profile will not show on this dashboard until someone shares a completed questionnaire with your organization. If you have requested a profile to complete a questionnaire, you can check their progress towards completion on the "Engage" dashboard.{% endtrans %}</td>
        </tr>
        <tr :id="received.account"
            :class="received.supplier_initiated ? 'supplier-initiated' : ''"
            v-for="(received, index) in grants.results"
            v-show="itemsLoaded && grants.results.length > 0" v-cloak>
            <td class="text-center" colspan="3">
              <img class="img-fluid" style="max-height: 1rem;" :src="received.account.picture || '{{'/static/img/default-organization.png'|asset}}'"><em class="pl-1">{% trans profile_name="[[received.account.printable_name ? received.account.printable_name : received.account]]" %}{{profile_name}} would like to share their response with you.{% endtrans %}</em>
            </td>
            <td :colspan="items.labels.length + 1">
                <button class="btn btn-secondary"
                        @click.prevent="ignore(received, index)">
                    {% trans %}Ignore{% endtrans %}
                </button>
                <button class="btn btn-primary"
                        @click.prevent="accept(received, index)">
                    {% trans %}Accept{% endtrans %}
                </button>
            </td>
        </tr>
        <tr :id="entry.slug"
            :class="entry.supplier_initiated ? 'supplier-initiated' : ''"
            v-for="(entry, index) in items.results"
            v-show="itemsLoaded && items.results.length > 0" v-cloak>
        <!-- profile whose report was requested at some point. -->
        <td>
          <span>[[index + 1 + (params.page ? (params.page - 1) * itemsPerPage : 0)]]</span><br />
        </td>
        <td>
          {% include "app/reporting/_profile_card.html" %}
        </td>
        <td>
          {% include "app/reporting/_edit_tags.html" %}
        </td>
        <td class="text-center"
            v-for="val in entry.values.slice().reverse()">
          <i class="fa fa-certificate" style="color: green;"
             v-if="val[1] === 'verified'"></i>
          <i class="fa fa-circle" style="color: green;"
             v-if="val[1] === 'completed'"></i>
          <i class="fa fa-circle" style="color: yellow;"
             v-if="val[1] === 'responded'"></i>
          <i class="fa fa-circle" style="color: red;"
             v-if="val[1] === 'declined'"></i>
          <i class="fa fa-circle" style="color: grey;"
             v-if="val[1] === 'no-data'"></i>
          <br />
          <a :href="val[2]" v-if="val[1] === 'verified' || val[1] === 'completed'">
              <small>[[$globals.humanizeMonthDay(val[0])]]</small>
          </a>
        </td>
        <td>
          <button class="btn btn-danger btn-sm" @click.prevent="remove($event, index)" data-trip data-trip-index="3" data-trip-content="<p>Click here to cancel access request.</p>" data-trip-position="s">
            <i class="fa fa-trash-o"></i>
          </button>
        </td>
        </tr>
      </tbody>
    </table>
    {% include "_pagination.html" %}
  </div>
</reporting-organizations>
{% endblock %}
